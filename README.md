# 自動販売機アンケート（Google Apps Script）

スプレッドシートとドライブのデータを元に、1ページで完結するアンケートフォームを提供します。飲みたい商品のTOP3を選択（1位=3pt / 2位=2pt / 3位=3pt）し、任意の自由記入欄を送信できます。回答はメールアドレスとともにスプレッドシートへ保存されます（フロントでは表示されません）。

## 事前準備

1. 下記のように、カテゴリ別のシートを持つスプレッドシートを用意します。  
   - シート名：`コーヒー` / `エナドリ` / `水` / `お茶` / `炭酸` / `スポドリ` / `その他(果汁等)`  
   - A列: 商品名, B列: メーカー名, C列: 価格, D列: 画像URL（Driveの共有URLでOK）
   - 先頭行にヘッダー（例: 商品名 / メーカー名 / 価格 / 画像URL）があっても自動的にスキップされます。
2. 商品画像用のドライブフォルダを用意します。フォルダ直下に「カテゴリ名（シート名）」ごとのサブフォルダを作成し、その中に商品名（シートA列）と同名の画像ファイルを配置してください。  
   - フォルダ内の画像ファイル名を正とし、シート内の商品名と突き合わせてメーカー・価格を表示します。  
   - 画像URL列（D列）が空の場合でも、このフォルダ構成から自動で画像を引き当てます（ファイル名の拡張子は無視されます）。
3. Apps Script プロジェクトのスクリプトプロパティまたはコードの定数に、スプレッドシートIDとドライブフォルダIDを設定します。

## セットアップ手順

1. 新しい Apps Script プロジェクトを作成し、`Code.gs` と `index.html` の内容をそれぞれ貼り付けます。
2. `Code.gs` 冒頭の定数を環境に合わせて設定します。
   ```js
   const SPREADSHEET_ID = '1xkg8vNscpcWTA6GA0VPxGTJCAH6LyvsYhq7VhOlDcXg';
   const PRODUCT_FOLDER_ID = '18fA4HRavIBTM2aPL-OqVaWhjRRgBhlKg';
   ```
3. 必要に応じて `回答` シート（1位〜3位のまとめ）と `集計` シート（順位別に1行ずつ記録）が自動作成されるため、回答保存用のシートを事前に用意する必要はありません。
4. 「デプロイ」>「新しいデプロイ」でウェブアプリとして公開します。  
   - 実行するデプロイ：`doGet`  
   - アクセスできるユーザー：回答者に合わせて設定（メールアドレス取得が必要な場合は、社内ユーザーに限定してください）

## 使い方

- フロントエンドは1ページ構成です。  
  1. カテゴリタブをクリックして商品を表示し、画像をクリックした順に1位・2位・3位を決めます（右上に「0/3」のカウンター表示、3つ選択で他はグレーアウト）。  
  2. 任意で自由記入欄に要望を入力。  
- 「送信」ボタンで回答を送信すると、`回答` シートに「タイムスタンプ／メールアドレス／1〜3位の商品／自由記入」が追記され、同時に `集計` シートに順位別のポイント（1位=3pt、2位=2pt、3位=3pt）が1行ずつ保存されます。

## フォルダ・スプレッドシートの共有設定

- 画像表示のため、シートに記載するDrive画像URLやフォルダは「リンクを知っている全員が閲覧可能」など、フォーム利用者が閲覧できる権限を付与してください。
- メールアドレスを自動取得するには、組織内ユーザーに限定し、スクリプトの権限付与を求める設定にしてください。外部公開の場合は `Session.getActiveUser().getEmail()` が空になる可能性があります。

## 構成

- `Code.gs`：データ取得（シート・Drive）、回答保存、`doGet` エントリーポイントを提供するサーバーコード。
- `index.html`：UI/UX とフロントロジック。`google.script.run` で `getInitialData` と `submitResponse` を呼び出します。
